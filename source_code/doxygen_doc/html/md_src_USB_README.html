<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Mooltipass: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="0_Mooltipass.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mooltipass
   </div>
   <div id="projectbrief">Offline Password Keeper</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Mooltipass will enumerate as a composite device with hid keyboard and generic hid classes. The keyboard interface is used for sending keypresses and the generic hid is used for transmitting data to/from pc side apps and plugins.</p>
<p>Data sent over the generic hid is made out of a 64 byte packet. The structure of the packet is as follows:</p>
<p>buffer[0] = length of data</p>
<p>buffer[1] = cmd identifier for this packet</p>
<p>buffer[2 till 2 + buffer[0]] = packet data</p>
<h1>Current commands </h1>
<p>Every sent packet will get one or more packets as an answer. Texts sent to and from the Mooltipass have payload length that include the terminating 0. In case the user currently is entering his PIN, the MP will only reply with a 0xB9 packet. The following commands are currently implemented:</p>
<h2>0xA0: send debug message </h2>
<p>From Mooltipass: packet data containing the debug message.</p>
<h2>0xA1: ping </h2>
<p>From Plugin/app: ping packet with 4 bytes payload</p>
<p>From Mooltipass: same packet that the plugin/app sent</p>
<h2>0xA2: version request </h2>
<p>From Plugin/app: Mooltipass version request</p>
<p>From Mooltipass: The first byte contains the FLASH_CHIP define which specifies how much memory the Mooltipass has. The rest is a string identifying the version</p>
<h2>0xA3: set context </h2>
<p>From Plugin/app: this allows the plugin/application to let the mooltipass know the website/service he's currently on</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the Mooltipass doesn't know the context, 0x01 if so and 0x03 that there's no card in the mooltipass</p>
<h2>0xA4: get login </h2>
<p>From plugin/app: request the login for the current context</p>
<p>From Mooltipass: the login if the user has approved the sending of credential / has been authorized, 1 byte 0x00 packet otherwise.</p>
<h2>0xA5: get password </h2>
<p>From plugin/app: request the password for the current context &amp; login</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the Mooltipass didn't send the password, data otherwise.</p>
<h2>0xA6: set login </h2>
<p>From plugin/app: set the login for the current context (either create a credential or select a given credential set)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xA7: set password </h2>
<p>From plugin/app: set the password for the current context</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xA8: check password </h2>
<p>From plugin/app: check the password for the current context &amp; selected login</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that password is not correct, 0x01 indicates the password is correct, 0x02 indicates the timer is still running so the request is blocked</p>
<h2>0xA9: add context </h2>
<p>From plugin/app: add a new context inside the mooltipass</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xAC: Get random number </h2>
<p>From plugin/app: Ask 32 random bytes</p>
<p>From Mooltipass: The 32 random bytes</p>
<h2>0xAD: Start memory management mode </h2>
<p>From plugin/app: Ask the user to approve memory management mode</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xAE: Media import start </h2>
<p>From plugin/app: Request for media contents sending to Mooltipass.</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xAF: Media import </h2>
<p>From plugin/app: A bunch of data to store inside the media part of flash, particularly formatted (see source files)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xB0: Media import end </h2>
<p>From plugin/app: Inform that we finished the media flash import</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xB1: Set Mooltipass parameter </h2>
<p>From plugin/app: Set Mooltipass parameter, first byte is the param ID, second is the value</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xB2: Get Mooltipass parameter </h2>
<p>From plugin/app: Get parameter from Mooltipass, first byte is the param ID</p>
<p>From Mooltipass: The param value</p>
<h2>0xB3: Reset card </h2>
<p>From plugin/app: Reset inserted card</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xB4: Read Card Login </h2>
<p>From plugin/app: Read login stored inside the smartcard (no confirmation asked from the user)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, data otherwise</p>
<h2>0xB5: Read Card Password </h2>
<p>From plugin/app: Read password stored inside the smartcard (confirmation asked to the user)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, data otherwise</p>
<h2>0xB6: Set Card Login </h2>
<p>From plugin/app: Set login stored inside the smartcard, 62bytes max length (confirmation asked to the user)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xB7: Set Card Password </h2>
<p>From plugin/app: Set password stored inside the smartcard, 30bytes max length (confirmation asked to the user)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xB8: Add unknown smartcard </h2>
<p>From plugin/app: When an unknown smartcard is inserted, tell the Mooltipass to store it. First 8 bytes are the current card CPZ, 16 next bytes are our user CTR value</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, data otherwise</p>
<h2>0xB9: Mooltipass status </h2>
<p>From plugin/app: Query Mooltipass status</p>
<p>From Mooltipass: 1 bytes bit field. BIT0: smartcard presence. BIT1: pin unlocking screen. BIT2: smartcard present and unlocked. BIT3: Unknown smartcard inserted</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;0b000 -&gt; No Card</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;0b001 -&gt; Locked</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;0b010 -&gt; Error (shouldn&#39;t happen)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;0b011 -&gt; Locked (unlocking screen)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;0b100 -&gt; Error (shouldn&#39;t happen)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;0b101 -&gt; Unlocked</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;0b110 -&gt; Error (shouldn&#39;t happen)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;0b111 -&gt; Error (shouldn&#39;t happen)</div></div><!-- fragment --><h2>0xBB: Set current date </h2>
<p>From plugin/app: Set current date (16 bits encoding: 15 dn 9 -&gt; Year (2010 + val), 8 dn 5 -&gt; Month, 4 dn 0 -&gt; Day of Month)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xBC: Set Mooltipass UID </h2>
<p>From plugin/app: Set the Mooltipass UID, 16 + 6 bytes packet with the request key and the UID</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, data otherwise</p>
<h2>0xBD: Get Mooltipass UID </h2>
<p>From plugin/app: Get Mooltipass UID. The 16 bytes request key must be sent</p>
<p>From Mooltipass: Either a one byte packet when an error occurs or the mooltipass UID</p>
<h2>0xBE: set data context </h2>
<p>From Plugin/app: this allows the plugin/application to let the mooltipass know the data service he's currently on</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the Mooltipass doesn't know the context, 0x01 if so and 0x03 that there's no card in the mooltipass</p>
<h2>0xBF: add data context </h2>
<p>From plugin/app: add a new data context inside the mooltipass</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xC0: Write 32 bytes in current context </h2>
<p>From plugin/app: add 32 bytes of data to the current data context. If first byte different to 0, means it is the last 32B block. 32 bytes data block starts at payload[1]</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xC1: Read 32 bytes in current context </h2>
<p>From plugin/app: after a set data context has been sent, get successive 32bytes data blocks</p>
<p>From Mooltipass: 0x00 when error or end of data, 32 bytes of data otherwise</p>
<h2>0xC2: Get current card CPZ </h2>
<p>From plugin/app: ask the CPZ of the currently inserted card, when unknown card is inserted</p>
<p>From Mooltipass: 0x00 when error or end of data, the CPZ otherwise</p>
<h2>0xC3: Cancel User Request </h2>
<p>From plugin/app: cancel input request from user</p>
<h2>0xC4: Please Retry </h2>
<p>From Mooltipass: Message informing the app to re-send the previous packet</p>
<h1>Commands in data management mode </h1>
<h2>0xC5: Read node in flash </h2>
<p>From plugin/app: With two bytes indicating the node number, read a user node in flash</p>
<p>From Mooltipass: The node or 0x00 when error</p>
<h2>0xC6: Write node in flash </h2>
<p>From plugin/app: With two bytes indicating the node number and another indicating the packet #, write a node in flash. See source for data formatting</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xC7: Get Favorite </h2>
<p>From plugin/app: Get favorite for current user, first byte is the slot ID</p>
<p>From Mooltipass: 0x00 if not performed, 4 bytes of data otherwise (parent + child addr)</p>
<h2>0xC8: Set favorite </h2>
<p>From plugin/app: First byte indicates favId, next 2 the parent addr, next 2 the child addr</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xC9: Get Starting parent Address </h2>
<p>From plugin/app: In management mode, get the address of the starting parent</p>
<p>From Mooltipass: 0x00 if failure, slot address otherwise</p>
<h2>0xCA: Set starting parent </h2>
<p>From plugin/app: First two bytes is the new starting parent (LSB first)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xCB: Get CTR value </h2>
<p>From plugin/app: In management mode, get the current user CTR value</p>
<p>From Mooltipass: 0x00 if failure, CTR value otherwise</p>
<h2>0xCC: Set CTR value </h2>
<p>From plugin/app: First three bytes is the new CTR value</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xCD: Add CPZ CTR value </h2>
<p>From plugin/app: Add a known card to the MP, 8 first bytes is the CPZ, next 16 is the CTR nonce</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xCE: Get CPZ CTR value </h2>
<p>From plugin/app: Get all the cpz ctr values for current user</p>
<p>From Mooltipass: 0x00 if denied, 0xCF packets for LUT entries, then a final 0x01</p>
<h2>0xCF: CPZ CTR packet export </h2>
<p>From Mooltipass: One CPZ CTR LUT entry packet</p>
<h2>0xD0: Get Free Slot Addresses </h2>
<p>From plugin/app: 2 bytes payload indicating the address to start scanning from (in doubt, set 0x00 0x00).</p>
<p>From Mooltipass: 0x00 if failure, 31 slot addresses max otherwise (see payload length field)</p>
<h2>0xD1: Get Starting data parent Address </h2>
<p>From plugin/app: In management mode, get the address of the data starting parent</p>
<p>From Mooltipass: 0x00 if failure, slot address otherwise</p>
<h2>0xD2: Set starting data parent </h2>
<p>From plugin/app: First two bytes is the new data starting parent (LSB first)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0xD3: End memory management mode </h2>
<p>From plugin/app: Leave memory management mode</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h1>Obsolete commands </h1>
<h2>0x8A: export flash start (for full import/export fw version) </h2>
<p>From plugin/app: Request for flash contents export to Mooltipass.</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0x8B: export flash (for full import/export fw version) </h2>
<p>From plugin/app: request for a bunch of data</p>
<p>From Mooltipass: the bunch of requested data</p>
<h2>0x8C: export flash end (for full import/export fw version) </h2>
<p>From plugin/app: stop flash export</p>
<p>From Mooltipass: end of flash export</p>
<h2>0x8D: import flash start (for full import/export fw version) </h2>
<p>From plugin/app: Request for flash contents sending to Mooltipass. A 0x00 in parameter implies user space while a 0x01 specifies the graphics part of flash</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0x8E: import flash (for full import/export fw version) </h2>
<p>From plugin/app: A bunch of data to store inside the flash, particularly formatted (see source files)</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0x8F: import flash end (for full import/export fw version) </h2>
<p>From plugin/app: Inform that we finished the flash import</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0x90: export eeprom start (for full import/export fw version) </h2>
<p>From plugin/app: Request for eeprom contents export to Mooltipass.</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0x91: export eeprom (for full import/export fw version) </h2>
<p>From plugin/app: export eeprom contents request</p>
<p>From Mooltipass: the bunch of requested data</p>
<h2>0x92: export eeprom end (for full import/export fw version) </h2>
<p>From plugin/app: stop eeprom export</p>
<p>From Mooltipass: end of eeprom export</p>
<h2>0x93: import eeprom start (for full import/export fw version) </h2>
<p>From plugin/app: Request for eeprom contents sending to Mooltipass.</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0x94: import eeprom (for full import/export fw version) </h2>
<p>From plugin/app: A bunch of data to store inside the eeprom</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so</p>
<h2>0x95: import eeprom end (for full import/export fw version) </h2>
<p>From plugin/app: Inform that we finished the flash import</p>
<p>From Mooltipass: 1 byte data packet, 0x00 indicates that the request wasn't performed, 0x01 if so </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu May 5 2016 10:42:40 for Mooltipass by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
