<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Mooltipass: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="0_Mooltipass.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mooltipass
   </div>
   <div id="projectbrief">Offline Password Keeper</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>#Node Management Library for Mooltipass Michael Neiderhauser Jun-15-2014</p>
<p>Files:</p><ul>
<li><a class="el" href="node__mgmt_8c.html" title="Mooltipass Node Management Library Created: 03/4/2014 Author: Michael Neiderhauser Modified: 18/08/20...">node_mgmt.c</a></li>
<li><a class="el" href="node__mgmt_8h.html" title="Mooltipass Node Management Library Header Created: 03/4/2014 Author: Michael Neiderhauser. ">node_mgmt.h</a></li>
</ul>
<p>The Node Management Library was written to be the primary flash data structure for the Mooltipass. The Node Management Library makes use of the Flash Memory Library for Mooltipass. The library is implemented as a linked list.</p>
<p>Details about the node layout as well as how they are represented in memory can be found at the link below: <a href="https://docs.google.com/drawings/d/1og2-RgrFOL5XlW0ICNUDv2R0IQK8geOhonX9XfuuFjk/edit">https://docs.google.com/drawings/d/1og2-RgrFOL5XlW0ICNUDv2R0IQK8geOhonX9XfuuFjk/edit</a></p>
<p>Currently basic credential storage has been implemented and tested. There are still a few features that need to be implemented and they should arrive soon. Some of the features in the Node Management Library require Mooltipass plugin support.</p>
<p>Nodes are stored in a stack and heap layout. All nodes are doubly linked. A parent node and child node (child node start of data, or data node) can co-exist on the same memory page.</p>
<p>The Node Management library requires the user to provide allocated space of a handle. The user should not directly modify this handle. The Node Management library also implements support for basic user profiles. A user profile is used to store the users first parent node (credential) and is used to allow a user to store 'favourite' credentials. There are a maximum of 16 favourites allowed and a total of 16 possible users.</p>
<h2>Node Details</h2>
<h3>Parent Node</h3>
<p>Used to store the base 'service' of a credential.</p><ul>
<li>flags (used internally to indicate validity and type of the node. associates user id with the node)</li>
<li>nextChildAddress (Node Address of the parents first child)</li>
<li>prevParentAddress (Used to implement the linked list)</li>
<li>nextParentAddress (Used to implement the linked list)</li>
<li>service[58] (Used to indicate the 'service' of the credential ex 'hackaday.io')</li>
</ul>
<h3>Child Node</h3>
<p>Used to store the user name and password of a credential flags (used internally to indicate validity and type of the node) prevChildAddress (Used to implement the linked list) nextChildAddress (Used to implement the linked list) description[24] (Plain-text description of the credential) dateCreated (Date the credential was first added to the Mooltipass. plug-in required) dateLastUsed (Date the credential was last used. plug-in required) ctr[3] (Used for encryption) login[63] (Plain-text user name) password[32] (encrypted password)</p>
<h3>Child start of data Node</h3>
<p>More later </p><h3>Data Node</h3>
<p>More Later</p>
<h2>Library Usage</h2>
<p>// Declare a return variable RET_TYPE ret = RETURN_NOK;</p>
<p>// Select a User ID uint8_t uid = 0;</p>
<p>// (OPTIONAL) Format the user profile memory and check the return code ret = formatUserProfileMemory(uid); if(ret != RETURN_OK) { // do something }</p>
<p>// Obtain a Node Management Handle with the user id and check the return code mgmtHandle h; mgmtHandle *hp =  ret = initNodeManagementHandle(hp, uid); if(ret != RETURN_OK) { // do something }</p>
<p>// Creating a Parent Node pNode parent; parent.service = "Some Text";</p>
<p>ret = createParentNode(hp, &amp;parent); if(ret != RETURN_OK) { // do something }</p>
<p>// Updating a Parent Node // only field the user should update is service parent.service = "Some Text"; ret = updateParentNode(hp, &amp;parent); if(ret != RETURN_OK) { // do something }</p>
<p>// Constructing a Parent Node Address uint16_t pageNumber = 128; uint8_t nodeNumber = 0; uint16_t parentNodeAddress = constructAddress(pageNumber, nodeNumber);</p>
<p>// Reading a Parent Node ret = readParentNode(hp, &amp;parent, parentNodeAddress); if(ret != RETURN_OK) { // do something }</p>
<p>// Deleting a Parent Node /* typedef enum { DELETE_POLICY_WRITE_NOTHING = 1, /*!&lt; Flip valid bit */ DELETE_POLICY_WRITE_ZEROS = 0x00, /*!&lt; Write node with all 0's */ DELETE_POLICY_WRITE_ONES = 0xff, /*!&lt; Write node with all 1's */ } deletePolicy; */ ret = deleteParentNode(hp, parentNodeAddress, DELETE_POLICY_WRITE_ONES); if(ret != RETURN_OK) { // do something }</p>
<p>// Deconstruction of a Node Address pageNumber = pageNumberFromAddress(parentNodeAddress); nodeNumber = nodeNumberFromAddress(parentNodeAddress);</p>
<p>// Creating a Child Node uint16_t addressOfChildParent = constructAddress(128,1); cNode child;</p>
<p>// modify child here ret = createChildNode(hp, addressOfChildParent, &amp;child); if(ret != RETURN_OK) { // do something }</p>
<p>// Reading a Child Node ret = readParentNode(hp, addressOfChildParent); if(ret != RETURN_OK) { // do something }</p>
<p>ret = readChildNode(hp, &amp;child, parent.nextChildAddress); // use specific child node address if(ret != RETURN_OK) { // do something }</p>
<p>// Updating a Child Node // modify child node ret = updateChildNode(hp, &amp;parent, &amp;child, addressOfChildParent, parent.nextChildAddress); // use specific child node address if(ret != RETURN_OK) { // do something }</p>
<p>// Deleting a Child Node /* typedef enum { DELETE_POLICY_WRITE_NOTHING = 1, /*!&lt; Flip valid bit */ DELETE_POLICY_WRITE_ZEROS = 0x00, /*!&lt; Write node with all 0's */ DELETE_POLICY_WRITE_ONES = 0xff, /*!&lt; Write node with all 1's */ } deletePolicy; */ ret = deleteChildNode(hp, addressOfChildParent, parent.nextChildAddress, DELETE_POLICY_WRITE_ONES); // use specific child node address if(ret != RETURN_OK) { // do something }</p>
<p>// Setting a User Profile Favourite // Assuming you know the address of a Parent / Child Credential Set uint16_t parentAddress = KNOWN_PARENT; uint16_t childAddress = KNOWN_CHILD; uint8_t favId = 0; ret = setFav(hp, favId, parentAddress, childAddress); if(ret != RETURN_OK) { // do something }</p>
<p>// Clearing a User Profile Favourite uint16_t parentAddress = NODE_ADDR_NULL; uint16_t childAddress = NODE_ADDR_NULL; uint8_t favId = 0; ret = setFav(hp, favId, parentAddress, childAddress); if(ret != RETURN_OK) { // do something }</p>
<p>// Setting a User Profile Favourite // Assuming you know the favId uint16_t parentAddress = 0; uint16_t childAddress = 0; uint8_t favId = KNOWN_FAV_ID; ret = readFav(hp, favId, &amp;parentAddress, &amp;childAddress); if(ret != RETURN_OK) { // do something }</p>
<p>// Other functions can be found in <a class="el" href="node__mgmt_8h.html" title="Mooltipass Node Management Library Header Created: 03/4/2014 Author: Michael Neiderhauser. ">node_mgmt.h</a> Note: Always check the return code</p>
<h2>Flash Memory Testing</h2>
<p>Files:</p><ul>
<li>node_test.c</li>
<li>node_test.h</li>
</ul>
<p>Node Testing attempts to exercise the library for linked list functionality. It also unit tests the helper functions of the library. To run Flash Testing: Include the node_test.h file and call the nodeTest() Function.</p>
<p>To run Flash Testing on the Mooltipass: In the file <a class="el" href="tests_8c.html" title="Test functions Copyright [2014] [Mathieu Stephan]. ">tests.c</a> uncomment the (pound)define TEST_NODE in the <a class="el" href="tests_8c.html#addcf4f96c53f7eb5ceaca415681abf65" title="Test functions launched after flash init. ">afterFlashInitTests()</a> function.</p>
<p>Note: The <a class="el" href="flash__test_8c.html" title="Mooltipass Flash IC Library Test Functions Created: 31/3/2014 Author: Michael Neiderhauser. ">flash_test.c</a> file does use oled and usb libs of the mooltipass however this should be easy to remove if needed. Note: Check the enums of node testing errors in the node_test.h file.</p>
<h2>Library TODO's</h2>
<ul>
<li>Implement algorithm for child start of data and data nodes to allow for 'large' data storage (SSH Keys anyone?)</li>
<li>Optimize Implementation (Share code when possible)</li>
<li>Fix creatChildNode shared buffer issue. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu May 5 2016 10:42:40 for Mooltipass by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
